#!/bin/sh
set -e

echo "[Riptide Quality Gate] Running pre-commit checks..."

# Step 1: Check formatting
echo "› Checking format..."
cargo fmt --all -- --check

# Step 2: Run Clippy (strict) - DISABLED during refactor
echo "› Linting with clippy (warnings only)..."
cargo clippy --workspace --all-targets
# TODO: Enable strict mode after streaming refactor: cargo clippy --workspace --all-targets -- -D warnings

# Step 3: Run core tests (streaming tests ignored during refactor)
echo "› Running core tests..."
cargo test --workspace -- --quiet
# Integration tests (streaming tests ignored by default)
# TODO: Fix test target configuration: cargo test --test style_enforcement_test --test torrent_protocol_test --test peer_communication_test -- --quiet

echo "✓ All checks passed. Commit approved."
