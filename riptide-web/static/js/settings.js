import{A as l}from"./api-client-touATVF3.js";class c{constructor(){this.apiClient=new l}initialize(){this.setupEventListeners()}setupEventListeners(){const e=document.querySelector(".settings-form"),t=document.getElementById("reset-settings");e&&e.addEventListener("submit",n=>this.saveSettings(n)),t&&t.addEventListener("click",()=>this.resetSettings())}async saveSettings(e){e.preventDefault();const t=e.target,n=new FormData(t),i=this.extractSettingsFromForm(n),s=document.getElementById("settings-result");if(s)try{await this.apiClient.updateSettings(i),s.className="result-message success",s.textContent="Settings saved successfully!",s.style.display="block",setTimeout(()=>{s.style.display="none"},3e3)}catch(r){const a=r instanceof Error?r.message:"Unknown error";s.className="result-message error",s.textContent=`Failed to save settings: ${a}`,s.style.display="block",setTimeout(()=>{s.style.display="none"},5e3)}}extractSettingsFromForm(e){const t=i=>{const s=e.get(i);return s&&s.trim()?parseInt(s,10):void 0},n=i=>e.has(i);return{download_limit:t("download_limit"),upload_limit:t("upload_limit"),max_connections:t("max_connections")||50,streaming_port:t("streaming_port")||8080,web_ui_port:t("web_ui_port")||3e3,enable_upnp:n("enable_upnp"),enable_dht:n("enable_dht"),enable_pex:n("enable_pex")}}async resetSettings(){if(confirm("Reset all settings to defaults?"))try{await this.apiClient.resetSettings(),location.reload()}catch(e){const t=e instanceof Error?e.message:"Unknown error";alert(`Failed to reset settings: ${t}`)}}async loadCurrentSettings(){try{return await this.apiClient.getSettings()}catch(e){return console.error("Failed to load current settings:",e),null}}populateForm(e){var t,n;this.setInputValue("download-limit",((t=e.download_limit)==null?void 0:t.toString())||""),this.setInputValue("upload-limit",((n=e.upload_limit)==null?void 0:n.toString())||""),this.setInputValue("max-connections",e.max_connections.toString()),this.setInputValue("streaming-port",e.streaming_port.toString()),this.setInputValue("web-ui-port",e.web_ui_port.toString()),this.setCheckboxValue("enable-upnp",e.enable_upnp),this.setCheckboxValue("enable-dht",e.enable_dht),this.setCheckboxValue("enable-pex",e.enable_pex)}setInputValue(e,t){const n=document.getElementById(e);n&&(n.value=t)}setCheckboxValue(e,t){const n=document.getElementById(e);n&&(n.checked=t)}}document.addEventListener("DOMContentLoaded",async()=>{const o=new c;o.initialize();const e=await o.loadCurrentSettings();e&&o.populateForm(e)});
